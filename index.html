<!DOCTYPE html>
<meta charset="utf-8" />
<html>
  <head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-array.v2.min.js"></script>
    <script src="js/setChart.js"></script>

    <style>
      body {
        font: 1rem sans-serif;
        margin: 4px 20px 0px 20px;
        background-color: white;
      }

      table {
        width: 100%;
      }

      #logo {
        text-align: right;
      }
    </style>
  </head>
  <body>
    <table>
      <tr>
        <td>
          <h2>SetVis</h2>
          <h3>Conference Committee Service 2020</h3>
        </td>

        <td id="logo"><a href="https://vis.ornl.gov/" target="_blank"><img src="img/vista-logo.png" height=70 alt="ORNL VISTA Vis Lab"></img></a></td>
      </tr>
    </table>
    <div id="chart"></div>
    <br/><br/>
    <center>
      <h4>&copy; <a href="https://www.ornl.gov">Oak Ridge National Laboratory</a>
          <script type="text/javascript">
              document.write(new Date().getFullYear());
          </script>
      </h4>
    </center>
    <br/>
    <br/>
  </body>

  <script>
    const chartMargin = {top:100, right:20, bottom:20, left:160};
    let chartData;
    let chart;
    let confNames;

    const createChart = () => {
      if (chartData) {
        const chartWidth = document.getElementById('chart').clientWidth;
        chart = setChart()
          .margin(chartMargin)
          .boxSize(20)
          // .width(chartWidth)
          // .height(400)
          .nameValue(d => d.Name)
          // .setNames(['Set1','Set2','Set3']);
          .setNames(confNames);
        d3.select('#chart').call(chart, chartData);
      }
    }

    d3.csv("data/confPC_v1.csv", d3.autoType)
      .then(data => {
        console.log(data);
        confNames = data.columns.filter(d => d !== 'Name' && d !== 'Year')
        console.log(confNames);
        chartData = data.filter(d => d.Year === 2020);
        console.log(chartData);
        // columnCategories = new Map();
        // // data = data.filter(d => d.Year === 2020)
        // // console.log(data);

        // data.columns.forEach(column => {
        //   if (column !== 'Name') {
        //     let conf = column.substring(0, column.indexOf(','));
        //     console.log(conf);
        //     let confColumns = columnCategories.get(conf);
        //     if (!confColumns) {
        //       confColumns = [];
        //       columnCategories.set(conf, confColumns);
        //     }
        //     confColumns.push(column);
        //   }
        // });
        // console.log(columnCategories);
        // console.log(columnCategories.keys());

        // chartData = [];
        // data.forEach(d => {
        //   confRollups = new Map();
        //   columnCategories.forEach((value, key) => {
        //     let inConf = false;
        //     value.forEach(v => {
        //       if (d[v] === 1) {
        //         inConf = true;
        //       }
        //     });
        //     confRollups.set(key, inConf);
        //     // console.log(`key: ${key}  value: ${value}`);
        //   });
        //   chartDatum = {Name: d.Name}
        //   // console.log(confRollups);
        //   confRollups.forEach((value, key) => {
        //     chartDatum[key] = value;
        //   })
        //   chartData.push(chartDatum);
        // })
        // // chartData = data;
        // confNames = [...columnCategories.keys()];
        // console.log(confNames);
        // console.log(chartData);
        createChart();
      })
      .catch(error => {
        console.log(error);
      })

  </script>
</html>